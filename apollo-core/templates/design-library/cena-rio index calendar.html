<!doctype html>
<html lang="pt-BR" class="h-full">
<!--
================================================================================
  APOLLO TEMPLATE: CENA::RIO - CALENDÁRIO AVANÇADO (INDEX PAGE)
  Version: 1.0.0
  Plugin: apollo-events-manager / apollo-core
  PHP File: templates/shortcode-cena-rio.php

  STRUCTURE INDEX:
  ================
  [HEAD]        → Meta tags, Assets (CSS/JS), CSS Variables
  [LAYOUT]      → App shell (flex container)
  [SIDEBAR]     → Left sidebar desktop navigation
  [HEADER]      → Top bar with month navigation
  [WORKSPACE]   → Main grid: calendar + map + events
  [CALENDAR]    → Interactive calendar with event dots
  [MAP]         → Leaflet map with event markers
  [EVENTS]      → Events list/grid panel
  [NAVIGATION]  → Bottom mobile navigation
  [MODAL]       → Event create/edit modal
  [SCRIPTS]     → JavaScript logic (calendar, events, map)

  PHP VARIABLES TO REPLACE:
  =========================
  - $events_data (WP_Query or array from apollo_events table)
  - $current_user (wp_get_current_user())
  - $current_month (default: date('m'))
  - $current_year (default: date('Y'))
  - $view_mode (calendar, list, map)

================================================================================
-->

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Cena::rio · Calendário Avançado</title>

  <!-- ====================================================================
       [HEAD::ASSETS] External Dependencies
       PHP: Use wp_enqueue_style() / wp_enqueue_script() instead
       ==================================================================== -->
  <!-- UNI.CSS Global Design System -->
  <link rel="stylesheet" href="https://assets.apollo.rio.br/uni.css">
  <script src="https://assets.apollo.rio.br/base.js" defer></script>

  <!-- TAILWIND (utilities) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- REMIXICON -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.7.0/fonts/remixicon.css" rel="stylesheet" />

  <!-- LEAFLET MAP -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- ====================================================================
       [HEAD::CSS_VARIABLES] Design Tokens
       PHP: These should match uni.css root variables
       ==================================================================== -->
  <style>
    /* ============================================================
       [ELEMENT::CSS_VARIABLES] Root Design Tokens
       ============================================================ */
    :root {
      --bg: #f8fafc;
      --muted: #64748b;
      --accent: #f97316;
      --accent-strong: #ea580c;
      --confirmed: #10b981;
      --published: #3b82f6;
      --card: #ffffff;
      --border: #e6eef6;
      --shadow: 0 8px 30px rgba(15, 23, 42, 0.06);
    }

    /* ============================================================
       [ELEMENT::BASE_STYLES] Body & Global Resets
       ============================================================ */
    html,
    body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      font-family: Inter, system-ui, Arial;
    }

    /* ============================================================
       [LAYOUT::APP_SHELL] Main App Container
       ============================================================ */
    .app {
      display: flex;
      min-height: 100vh;
      gap: 0;
    }

    /* ============================================================
       [SIDEBAR::DESKTOP] Left Navigation (Desktop Only)
       ============================================================ */
    aside.leftbar {
      width: 14rem;
      background: #fff;
      border-right: 1px solid #eef2f7;
      display: flex;
      flex-direction: column;
      z-index: 40;
    }

    @media (max-width: 980px) {
      aside.leftbar {
        display: none
      }
    }

    /* ============================================================
       [LAYOUT::MAIN_CONTENT] Main Content Area
       ============================================================ */
    main.content {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* ============================================================
       [HEADER::TOP_BAR] Sticky Header with Month Navigation
       ============================================================ */
    header.topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 12px 20px;
      background: rgba(255, 255, 255, 0.9);
      border-bottom: 1px solid #eef2f7;
      position: sticky;
      top: 0;
      z-index: 60;
      backdrop-filter: blur(6px);
    }

    /* ============================================================
       [LAYOUT::WORKSPACE_GRID] Calendar + Map + Events Layout
       Desktop: row 1 = calendário + mapa; row 2 = eventos
       Mobile: cal -> eventos -> mapa
       ============================================================ */
    .workspace {
      display: grid;
      grid-template-columns: minmax(0, 320px) minmax(0, 1fr);
      grid-template-rows: auto auto;
      grid-template-areas:
        "calendar map"
        "events   events";
      gap: 20px;
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
      width: 100%;
      box-sizing: border-box;
    }

    @media (max-width:1100px) {
      .workspace {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto;
        grid-template-areas:
          "calendar"
          "events"
          "map";
        padding-bottom: 0;
      }
    }

    /* ============================================================
       [WIDGET::CALENDAR_CARD] Calendar Widget Container
       ============================================================ */
    .calendar-card {
      grid-area: calendar;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      box-shadow: var(--shadow);
    }

    /* ============================================================
       [ELEMENT::CALENDAR_WEEKDAYS] Day of Week Headers
       ============================================================ */
    .weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      text-align: center;
      color: var(--muted);
      font-weight: 700;
      font-size: 12px;
      margin-top: 8px;
    }

    /* ============================================================
       [ELEMENT::CALENDAR_GRID] Calendar Days Grid
       ============================================================ */
    .grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-top: 8px;
    }

    /* ============================================================
       [ELEMENT::DAY_BUTTON] Individual Day Cell
       ============================================================ */
    .day-btn {
      height: 38px;
      border-radius: 10px;
      border: 1px solid transparent;
      background: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 400;
      font-size: 12px;
      color: #0f172a;
      cursor: pointer;
      position: relative;
    }

    .day-btn.disabled {
      opacity: 0.35;
      cursor: default
    }

    .day-btn.selected {
      background: #0f172a;
      color: #fff;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.12);
    }

    /* ============================================================
       [ELEMENT::DAY_DOTS] Multiple Event Dots per Day
       ============================================================ */
    .day-dots {
      position: absolute;
      top: 4px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 3px;
    }

    .day-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      opacity: 0.95;
      background: var(--accent);
    }

    .day-dot.confirmed {
      background: var(--confirmed);
    }

    .day-dot.published {
      background: var(--published);
    }

    /* ============================================================
       [BLOCK::EVENTS_PANEL] Events List Container
       ============================================================ */
    .events-panel {
      grid-area: events;
      min-height: 400px;
    }

    .events-grid {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
    }

    /* ============================================================
       [CARD::EVENT] Individual Event Card
       ============================================================ */
    .event-card {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px 20px;
      box-shadow: var(--shadow);
      transition: transform .12s ease, box-shadow .12s ease;
      gap: 16px;
    }

    @media (max-width: 640px) {
      .event-card {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .event-card .event-controls {
        width: 100%;
        justify-content: space-between;
        margin-top: 8px;
        padding-top: 8px;
        border-top: 1px solid #f1f5f9;
      }
    }

    /* [CARD::EVENT_STATES] Status Border Colors */
    .event-card.expected {
      border-left: 4px solid var(--accent);
    }

    .event-card.confirmed {
      border-left: 4px solid var(--confirmed);
    }

    /* [ELEMENT::EVENT_INFO] Event Details Section */
    .event-info {
      flex: 1;
      min-width: 0;
    }

    .event-controls {
      display: flex;
      align-items: center;
      gap: 16px;
      flex-shrink: 0;
    }

    .event-title {
      font-weight: 700;
      font-size: 16px;
      color: #0f172a;
    }

    .event-meta {
      font-size: 14px;
      color: #64748b;
      margin-top: 4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .event-actions {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    /* ============================================================
       [WIDGET::MAP_CARD] Leaflet Map Container
       ============================================================ */
    .map-card {
      grid-area: map;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 0;
      box-shadow: var(--shadow);
      overflow: hidden;
      min-height: 260px;
    }

    #footer-map {
      width: 100%;
      height: 100%;
      min-height: 260px;
    }

    @media (max-width:640px) {
      #footer-map {
        min-height: 220px;
      }
    }

    /* ============================================================
       [NAVIGATION::BOTTOM_MOBILE] Mobile Bottom Navigation
       ============================================================ */
    .bottom-nav {
      position: fixed;
      left: 0;
      right: 0;
      bottom: env(safe-area-inset-bottom, 0);
      display: flex;
      justify-content: space-around;
      align-items: center;
      height: 64px;
      padding: 8px 12px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.96), rgba(255, 255, 255, 0.98));
      backdrop-filter: blur(8px);
      z-index: 1200;
      box-shadow: 0 -6px 20px rgba(0, 0, 0, 0.06);
    }

    .bottom-nav .nav-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2px;
      font-size: 11px;
      color: #64748b;
      width: 56px;
    }

    .bottom-nav .nav-btn.active {
      color: #0f172a;
    }

    @media (min-width: 980px) {
      .bottom-nav {
        display: none
      }
    }

    /* ============================================================
       [ELEMENT::LEGEND] Calendar Status Legend
       ============================================================ */
    .legend {
      display: flex;
      gap: 12px;
      align-items: center;
      color: #475569;
      font-size: 13px;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .legend-dots {
      display: flex;
      gap: 3px;
    }

    .legend-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
    }

    .legend-dot.confirmed {
      background: var(--confirmed);
    }

    .legend-dot.published {
      background: var(--published);
    }

    /* ============================================================
       [ELEMENT::BUTTONS] Button Styles
       ============================================================ */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      border-radius: 8px;
      border: 1px solid transparent;
      background: #111827;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      font-size: 13px;
      transition: opacity 0.2s;
    }

    .btn:hover {
      opacity: 0.9;
    }

    .btn.ghost {
      background: transparent;
      color: #475569;
      border-color: var(--border)
    }

    .btn.ghost:hover {
      background: #f1f5f9;
      color: #0f172a;
    }

    .btn.small {
      padding: 6px 12px;
      font-size: 12px;
    }

    /* ============================================================
       [ELEMENT::HELPERS] Utility Classes
       ============================================================ */
    .muted {
      color: var(--muted)
    }

    :focus {
      outline: 3px solid rgba(99, 102, 241, 0.12);
      outline-offset: 2px;
    }
  </style>
</head>

<body class="h-full">

  <!-- ======================================================================
       [LAYOUT::APP_SHELL] Main Application Container
       ====================================================================== -->
  <div class="app">

    <!-- ==================================================================
         [SIDEBAR::DESKTOP] Left Navigation Sidebar (Desktop Only)
         PHP BLOCK: templates/partials/sidebar-desktop.php
         VARIABLES: $current_user, $menu_items, $active_page
         ================================================================== -->
    <aside class="leftbar">

      <!-- [SIDEBAR::HEADER] Logo & Branding -->
      <div class="h-16 flex items-center gap-3 px-6 border-b border-slate-100">
        <div
          class="h-9 w-9 rounded-xl bg-gradient-to-br from-orange-400 to-orange-600 flex items-center justify-center shadow-md shadow-orange-500/60">
          <i class="ri-slack-fill text-white text-[22px]"></i>
        </div>
        <div class="flex flex-col leading-tight">
          <span class="text-[9.5px] font-regular text-slate-400 uppercase tracking-[0.18em]">plataforma</span>
          <span class="text-[15px] font-extrabold text-slate-900">Apollo::rio</span>
        </div>
      </div>

      <!-- [SIDEBAR::NAVIGATION] Main Menu Links -->
      <nav class="flex-1 px-4 space-y-1 py-6 overflow-y-auto">
        <div class="px-2 mb-2 text-[9.5px] font-regular text-slate-400 uppercase tracking-wider">Navegação</div>

        <a href="#" class="flex items-center gap-3 px-3 py-2.5 text-slate-600 rounded-lg hover:bg-slate-50 group">
          <i class="ri-building-3-line text-lg"></i><span class="font-medium text-sm">Feed</span>
        </a>

        <a href="#" class="flex items-center gap-3 px-3 py-2.5 text-slate-600 rounded-lg hover:bg-slate-50 group">
          <i class="ri-calendar-event-line text-lg"></i><span class="font-medium text-sm">Eventos</span>
        </a>

        <a href="#" class="flex items-center gap-3 px-3 py-2.5 text-slate-600 rounded-lg hover:bg-slate-50 group">
          <i class="ri-user-community-fill text-lg"></i><span class="font-medium text-sm">Comunidades</span>
        </a>

        <a href="#" class="flex items-center gap-3 px-3 py-2.5 text-slate-600 rounded-lg hover:bg-slate-50 group">
          <i class="ri-team-fill text-lg"></i><span class="font-medium text-sm">Núcleos</span>
        </a>

        <a href="#" class="flex items-center gap-3 px-3 py-2.5 text-slate-600 rounded-lg hover:bg-slate-50 group">
          <i class="ri-megaphone-line text-lg"></i><span class="font-medium text-sm">Classificados</span>
        </a>

        <a href="#" class="flex items-center gap-3 px-3 py-2.5 text-slate-600 rounded-lg hover:bg-slate-50 group">
          <i class="ri-file-text-line text-lg"></i><span class="font-medium text-sm">Docs & Contratos</span>
        </a>

        <a href="#" class="flex items-center gap-3 px-3 py-2.5 text-slate-600 rounded-lg hover:bg-slate-50 group">
          <i class="ri-user-smile-fill text-lg"></i><span class="font-medium text-sm">Perfil</span>
        </a>

        <!-- @PHP: if(current_user_can('cena-rio') || current_user_can('administrator')): -->
        <div class="px-2 mt-4 mb-2 text-[9.5px] font-regular text-slate-400 uppercase tracking-wider">Cena::rio</div>

        <!-- [MENU_ITEM] Agenda (Active) -->
        <a href="#" class="flex items-center gap-3 px-3 py-2.5 bg-slate-100 text-slate-900 rounded-lg font-semibold">
          <i class="ri-calendar-line text-lg"></i><span class="text-sm">Agenda</span>
        </a>

        <!-- [MENU_ITEM] Fornecedores -->
        <a href="#" class="flex items-center gap-3 px-3 py-2.5 text-slate-600 rounded-lg hover:bg-slate-50 group">
          <i class="ri-bar-chart-grouped-line text-lg"></i><span class="font-medium text-sm">Fornecedores</span>
        </a>

        <!-- [MENU_ITEM] Documentos -->
        <a href="#" class="flex items-center gap-3 px-3 py-2.5 text-slate-600 rounded-lg hover:bg-slate-50 group">
          <i class="ri-file-text-line text-lg"></i><span class="font-medium text-sm">Documentos</span>
        </a>
        <!-- @PHP: endif; -->

        <div class="px-2 mt-4 mb-2 text-[9.5px] font-regular text-slate-400 uppercase tracking-wider">Acesso Rápido
        </div>
        <a href="#" class="flex items-center gap-3 px-3 py-2.5 text-slate-600 rounded-lg hover:bg-slate-50 group">
          <i class="ri-settings-6-line text-lg"></i><span class="font-medium text-sm">Ajustes</span>
        </a>
      </nav>

      <!-- [SIDEBAR::FOOTER_LINKS] -->
      <div class="p-0 rounded-lg group mb-4">
        <div class="relative flex w-full min-w-0 flex-col px-3">
          <div class="w-full text-sm">
            <ul class="flex w-full min-w-0 flex-col gap-0">
              <li class="relative">
                <a href="#"
                  class="flex w-full items-center gap-0 px-3 text-left text-slate-600 hover:bg-slate-100 text-[12px]">
                  <span>Sobre</span>
                </a>
              </li>
              <li class="relative">
                <a href="#"
                  class="flex w-full items-center gap-0 overflow-hidden rounded-md px-3 text-left text-slate-600 hover:bg-slate-100 text-[12px]">
                  <span>Ajustes</span>
                </a>
              </li>
              <li class="relative">
                <a href="#"
                  class="flex w-full items-center gap-0 px-3 text-left text-red-600 hover:bg-red-100 text-[12px]">
                  <span>Denúncia</span>
                </a>
              </li>
            </ul>
          </div>

          <!-- [SIDEBAR::USER_BLOCK] Current User Info -->
          <div class="flex flex-col gap-2 p-2 mt-3 border-t border-slate-200">
            <div class="flex items-center gap-3 px-2 mt-2">
              <div
                class="h-8 w-8 rounded-full bg-orange-100 flex items-center justify-center text-xs font-bold text-orange-600">
                AD</div>
              <div class="flex flex-col leading-tight">
                <span class="text-[14px] font-bold text-slate-900">Valle</span>
                <span class="text-[12px] text-slate-500">valle@email.com</span>
              </div>
              <button class="ml-auto text-slate-200 hover:text-slate-300" title="Logout">
                <i class="ri-logout-box-r-line text-[18px]"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </aside>
    <!-- [/SIDEBAR::DESKTOP] -->

    <!-- ==================================================================
         [LAYOUT::MAIN_CONTENT] Main Content Area
         ================================================================== -->
    <main class="content">

      <!-- ================================================================
           [HEADER::TOP_BAR] Page Header with Month Navigation
           PHP BLOCK: templates/partials/header-calendar.php
           ================================================================ -->
      <header class="topbar">
        <!-- [HEADER::TITLE_SECTION] Page Title -->
        <div style="display:flex;align-items:center;gap:12px">
          <div>
            <div class="text-lg font-bold">Calendário Mensal</div>
            <div class="text-sm muted">Planejamento da cena · Cena::rio</div>
          </div>
        </div>

        <!-- [HEADER::MONTH_NAVIGATION] Month Prev/Next Controls -->
        <div style="display:flex;gap:8px;align-items:center">
          <button id="prev-month" class="btn ghost small" aria-label="Mês anterior">
            <i class="ri-arrow-left-s-line"></i>
          </button>
          <!-- PHP: echo strtoupper( date('M Y', strtotime("$current_year-$current_month-01")) ); -->
          <div id="month-label" style="font-weight:800;min-width:140px;text-align:center"></div>
          <button id="next-month" class="btn ghost small" aria-label="Próximo mês">
            <i class="ri-arrow-right-s-line"></i>
          </button>
        </div>
      </header>
      <!-- [/HEADER::TOP_BAR] -->

      <!-- ================================================================
           [LAYOUT::WORKSPACE] Main Grid Area (Calendar + Map + Events)
           ================================================================ -->
      <section class="workspace">

        <!-- ==============================================================
             [WIDGET::CALENDAR] Interactive Calendar Widget
             PHP BLOCK: templates/partials/calendar-grid.php
             ============================================================== -->
        <aside class="calendar-card" aria-label="Calendário">

          <!-- [CALENDAR::HEADER] Title & Legend -->
          <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
            <div style="font-weight:700">Calendário</div>

            <!-- [ELEMENT::LEGEND] Status Legend -->
            <div class="legend">
              <div class="legend-item">
                <div class="legend-dots">
                  <span class="legend-dot"></span>
                </div>
                <span class="text-[10px]">Previsto</span>
              </div>
              <div class="legend-item">
                <div class="legend-dots">
                  <span class="legend-dot confirmed"></span>
                </div>
                <span class="text-[10px]">Confirmado</span>
              </div>
              <div class="legend-item">
                <div class="legend-dots">
                  <span class="legend-dot published"></span>
                </div>
                <span class="text-[10px]">Público</span>
              </div>
            </div>
          </div>

          <!-- [CALENDAR::WEEKDAYS] Day Headers -->
          <div class="weekdays" aria-hidden="true">
            <div>Dom</div>
            <div>Seg</div>
            <div>Ter</div>
            <div>Qua</div>
            <div>Qui</div>
            <div>Sex</div>
            <div>Sáb</div>
          </div>

          <!-- [CALENDAR::GRID] Calendar Days Grid -->
          <!-- PHP: Render via apollo_render_calendar_grid( $year, $month, $events ) -->
          <div id="calendar-grid" class="grid" role="grid" aria-label="Calendário mensal"></div>

          <!-- [CALENDAR::FOOTER] Add Event Button -->
          <div style="margin-top:12px;display:flex;gap:8px;justify-content:space-between;align-items:center">
            <!-- [BUTTON::ADD_EVENT] -->
            <button id="btn-add-event" class="btn"><i class="ri-add-line"></i> Novo Evento</button>
            <div style="font-size:10px;color:var(--muted)">Toque em um dia</div>
          </div>
        </aside>
        <!-- [/WIDGET::CALENDAR] -->

        <!-- ==============================================================
             [WIDGET::MAP] Leaflet Map with Event Markers
             PHP BLOCK: templates/partials/map-events.php
             ============================================================== -->
        <div class="map-card" aria-label="Mapa de eventos">
          <!-- PHP: Initialize map with event coordinates from $events_data -->
          <div id="footer-map"></div>
        </div>
        <!-- [/WIDGET::MAP] -->

        <!-- ==============================================================
             [BLOCK::EVENTS_LIST] Events Panel
             PHP BLOCK: templates/partials/events-list.php
             ============================================================== -->
        <section class="events-panel">

          <!-- [EVENTS::HEADER] Title & Actions -->
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div>
              <!-- PHP: Dynamic label based on selected date or "Todos os eventos" -->
              <div id="selected-day" style="font-weight:800; font-size: 1.1rem;">Todos os eventos</div>
              <div class="muted">Lista de produções</div>
            </div>
            <div style="display:flex;gap:8px;align-items:center">
              <!-- [BUTTON::MAP_CENTER] -->
              <button id="toggle-map" class="btn ghost small">
                <i class="ri-map-pin-line"></i> Centralizar no Mapa
              </button>
            </div>
          </div>

          <!-- [EVENTS::GRID] Events Cards Container -->
          <!-- PHP: foreach( $events as $event ): -->
          <div id="events-grid" class="events-grid" aria-live="polite">
            <!--
              [CARD::EVENT] Individual Event Card Structure:

              PHP VARIABLES:
              - $event->id
              - $event->title
              - $event->venue
              - $event->time
              - $event->tag (category)
              - $event->status (expected, confirmed, published)
              - $event->lat, $event->lng (coordinates)

              STRUCTURE:
              <article class="event-card expected|confirmed">
                <div class="event-info">
                  <div class="event-title"><?php echo $event->title; ?></div>
                  <div class="event-meta">
                    <span>date</span> · <i class="ri-time-line"></i> time ·
                    <i class="ri-map-pin-line"></i> venue
                  </div>
                </div>
                <div class="event-controls">
                  <div class="badge">Status</div>
                  <div class="event-actions">
                    <button class="btn small ghost">Edit</button>
                    <button class="btn small ghost">Delete</button>
                  </div>
                </div>
              </article>
            -->
          </div>
          <!-- PHP: endforeach; -->
        </section>
        <!-- [/BLOCK::EVENTS_LIST] -->

      </section>
      <!-- [/LAYOUT::WORKSPACE] -->

      <!-- ================================================================
           [NAVIGATION::BOTTOM_MOBILE] Mobile Bottom Navigation Bar
           PHP BLOCK: templates/partials/nav-bottom-mobile.php
           ================================================================ -->
      <div class="bottom-nav" role="navigation" aria-label="Navegação inferior">

        <!-- [NAV_ITEM] Agenda (Active) -->
        <div class="nav-btn active" onclick="location.href='#agenda'">
          <i class="ri-calendar-line"></i><span>Agenda</span>
        </div>

        <!-- [NAV_ITEM] Pro/Fornecedores -->
        <div class="nav-btn" onclick="location.href='#fornecedores'">
          <i class="ri-bar-chart-grouped-line"></i><span>Pro</span>
        </div>

        <!-- [NAV_ITEM::FAB] Floating Action Button -->
        <div style="position:relative;top:-18px">
          <button onclick="openQuickAdd()"
            class="h-14 w-14 rounded-full bg-slate-900 text-white flex items-center justify-center shadow-lg">
            <i class="ri-add-line text-3xl"></i>
          </button>
        </div>

        <!-- [NAV_ITEM] Docs -->
        <div class="nav-btn" onclick="location.href='#docs'">
          <i class="ri-file-text-line"></i><span>Docs</span>
        </div>

        <!-- [NAV_ITEM] Settings -->
        <div class="nav-btn" onclick="location.href='#settings'">
          <i class="ri-settings-3-line"></i><span>Ajustes</span>
        </div>
      </div>
      <!-- [/NAVIGATION::BOTTOM_MOBILE] -->

    </main>
    <!-- [/LAYOUT::MAIN_CONTENT] -->
  </div>
  <!-- [/LAYOUT::APP_SHELL] -->

  <!-- ======================================================================
       [MODAL::ROOT] Modal Container for Create/Edit Forms
       PHP: Can be a separate partial or use apollo modal system
       ====================================================================== -->
  <div id="modal-root" style="display:none">
    <!--
      [MODAL::EVENT_FORM] Event Create/Edit Modal Structure:

      PHP VARIABLES:
      - $event (null for create, object for edit)
      - $is_edit (boolean)
      - $nonce (wp_create_nonce('apollo_event'))

      FORM FIELDS:
      - ev-date: date input (required)
      - ev-title: text input (required)
      - ev-venue: text input (location)
      - ev-time: text input (time display)
      - ev-lat: number input (latitude)
      - ev-lng: number input (longitude)
    -->
  </div>

  <!-- ======================================================================
       [SCRIPTS::MAIN] JavaScript Logic
       PHP: Move to separate JS file and use wp_enqueue_script()
       ====================================================================== -->
  <script>
    /* =================================================================
       [DATA::EVENTS] Events Database
       PHP: Replace with server-side data:
       const events = <?php echo json_encode( apollo_get_events_data() ); ?>;
       ================================================================= */
    const STORAGE_KEY = 'cenario_events_v3';
    const DEFAULT_EVENTS = {
      "2025-11-09": [
        { id: "e1", title: "Dismantle · Puro Suco do Caos", venue: "Copacabana", time: "22:00 · sáb", tag: "Techno/House", status: "expected", lat: -22.9711, lng: -43.1822 },
        { id: "e2", title: "After Lovers (pós-Dismantle)", venue: "Botafogo", time: "04:30 · dom", tag: "After/Groove", status: "expected", lat: -22.9486, lng: -43.1800 }
      ],
      "2025-11-16": [
        { id: "e3", title: "Festival Miscelanea :: RJ", venue: "Zona Portuária", time: "18:00 · sáb", tag: "Festival", status: "confirmed", lat: -22.8968, lng: -43.1805 }
      ],
      "2025-11-23": [
        { id: "e4", title: "Cena::rio · Encontro Produtores", venue: "Centro", time: "15:00 · sáb", tag: "Encontro", status: "expected", lat: -22.9068, lng: -43.1729 }
      ]
    };

    /* [DATA::PERSISTENCE] LocalStorage Functions */
    function loadEvents() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return JSON.parse(JSON.stringify(DEFAULT_EVENTS));
        return JSON.parse(raw);
      } catch (e) { return JSON.parse(JSON.stringify(DEFAULT_EVENTS)); }
    }
    function saveEvents(obj) {
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(obj)); } catch (e) { }
    }

    let events = loadEvents();

    /* =================================================================
       [STATE::CALENDAR] Calendar View State
       PHP: Use server-side defaults: $viewYear, $viewMonth
       ================================================================= */
    const weekDays = ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "Sáb"];
    const months = ["jan", "fev", "mar", "abr", "mai", "jun", "jul", "ago", "set", "out", "nov", "dez"];
    let viewYear = 2025;
    let viewMonth = 10; // November (0-indexed)
    let selectedDate = null; // null = show all events

    /* =================================================================
       [DOM::REFS] DOM Element References
       ================================================================= */
    const gridEl = document.getElementById('calendar-grid');
    const monthLabelEl = document.getElementById('month-label');
    const selectedDayEl = document.getElementById('selected-day');
    const eventsGridEl = document.getElementById('events-grid');
    const prevMonthBtn = document.getElementById('prev-month');
    const nextMonthBtn = document.getElementById('next-month');
    const btnAdd = document.getElementById('btn-add-event');
    const footerMapEl = document.getElementById('footer-map');
    const toggleMapBtn = document.getElementById('toggle-map');

    /* =================================================================
       [MAP::SETUP] Leaflet Map Initialization
       PHP: Configure map center from settings or first event coords
       ================================================================= */
    let map, markersLayer;
    function initMap() {
      try {
        map = L.map('footer-map', { zoomControl: true }).setView([-22.9068, -43.1729], 12);

        map.createPane('tilesPane'); map.getPane('tilesPane').style.zIndex = 200;
        map.createPane('eventsPane'); map.getPane('eventsPane').style.zIndex = 600;
        map.createPane('uiPane'); map.getPane('uiPane').style.zIndex = 1200;

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          pane: 'tilesPane',
          attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        markersLayer = L.layerGroup([], { pane: 'eventsPane' }).addTo(map);
      } catch (e) {
        console.warn('Leaflet init failed', e);
        footerMapEl.style.display = 'none';
      }
    }

    /* [MAP::UPDATE_MARKERS] Update Map Markers from Events */
    function updateMapMarkers() {
      if (!markersLayer) return;
      markersLayer.clearLayers();
      const keys = Object.keys(events);
      const toShow = [];
      keys.forEach(k => {
        (events[k] || []).forEach(ev => {
          if (!selectedDate || selectedDate === k) toShow.push(ev);
        });
      });
      const coords = [];
      toShow.forEach(ev => {
        if (ev.lat && ev.lng) {
          const circle = L.circleMarker([ev.lat, ev.lng], {
            radius: ev.status === 'confirmed' ? 8 : 6,
            color: ev.status === 'confirmed'
              ? getComputedStyle(document.documentElement).getPropertyValue('--confirmed').trim()
              : getComputedStyle(document.documentElement).getPropertyValue('--accent').trim(),
            fillColor: ev.status === 'confirmed' ? '#10b981' : '#f97316',
            fillOpacity: 0.95,
            pane: 'eventsPane'
          });
          circle.bindPopup(
            `<strong>${escapeHtml(ev.title)}</strong><br>${escapeHtml(ev.venue)}<br>${escapeHtml(ev.time)}`,
            { autoPan: true, className: 'popup-ev' }
          );
          circle.addTo(markersLayer);
          coords.push([ev.lat, ev.lng]);
        }
      });
      if (coords.length) {
        const bounds = L.latLngBounds(coords);
        map.fitBounds(bounds.pad(0.5));
      }
    }

    /* =================================================================
       [CALENDAR::RENDER] Calendar Grid Rendering Functions
       ================================================================= */
    function pad(n) { return String(n).padStart(2, '0'); }
    function isoDate(y, m, d) { return `${y}-${pad(m)}-${pad(d)}`; } // m 1-based
    function daysInMonth(year, monthIndex) { return new Date(year, monthIndex + 1, 0).getDate(); }
    function firstWeekdayOfMonth(year, monthIndex) { return new Date(year, monthIndex, 1).getDay(); }

    function formatSelectedLabel(iso) {
      if (!iso) return 'Todos os eventos';
      const d = new Date(iso + 'T12:00:00');
      if (isNaN(d)) return 'Dia selecionado';
      const dayName = weekDays[d.getDay()];
      const dayNum = pad(d.getDate());
      const monthName = months[d.getMonth()];
      const year = d.getFullYear();
      return `${dayName} · ${dayNum} ${monthName} ${year}`;
    }

    function clearChildren(el) { while (el.firstChild) el.removeChild(el.firstChild); }

    function renderCalendar() {
      clearChildren(gridEl);
      const year = viewYear;
      const month = viewMonth;
      const totalDays = daysInMonth(year, month);
      const firstWeekday = firstWeekdayOfMonth(year, month);
      monthLabelEl.textContent = `${months[month].toUpperCase()} ${year}`;

      // Leading days (previous month)
      const prevMonthIndex = month - 1 < 0 ? 11 : month - 1;
      const prevMonthYear = month - 1 < 0 ? year - 1 : year;
      const prevMonthDays = daysInMonth(prevMonthYear, prevMonthIndex);
      const leadingCount = firstWeekday;
      for (let i = leadingCount - 1; i >= 0; i--) {
        const dayNum = prevMonthDays - i;
        const iso = isoDate(prevMonthYear, prevMonthIndex + 1, dayNum);
        const btn = createDayButton({ day: dayNum, iso, disabled: true, events: [] });
        gridEl.appendChild(btn);
      }

      // Current month days
      for (let d = 1; d <= totalDays; d++) {
        const iso = isoDate(year, month + 1, d);
        const dayEvents = events[iso] || [];
        const isSelected = iso === selectedDate;
        const btn = createDayButton({ day: d, iso, events: dayEvents, selected: isSelected });
        gridEl.appendChild(btn);
      }

      // Trailing days (next month)
      const totalCells = leadingCount + totalDays;
      const trailing = (7 - (totalCells % 7)) % 7;
      const nextMonthIndex = month + 1 > 11 ? 0 : month + 1;
      const nextMonthYear = month + 1 > 11 ? year + 1 : year;
      for (let t = 1; t <= trailing; t++) {
        const iso = isoDate(nextMonthYear, nextMonthIndex + 1, t);
        const btn = createDayButton({ day: t, iso, disabled: true, events: [] });
        gridEl.appendChild(btn);
      }
    }

    /* [CALENDAR::DAY_BUTTON] Create Day Cell with Event Dots */
    function createDayButton({ day, iso, disabled = false, events = [], selected = false }) {
      const btn = document.createElement('button');
      btn.className = 'day-btn';
      btn.type = 'button';
      btn.setAttribute('role', 'gridcell');
      btn.setAttribute('aria-label', `${day}`);
      btn.textContent = day;

      if (disabled) {
        btn.classList.add('disabled');
        btn.disabled = true;
        return btn;
      }

      btn.dataset.date = iso;
      btn.tabIndex = 0;
      if (selected) btn.classList.add('selected');

      if (events && events.length) {
        const wrapper = document.createElement('div');
        wrapper.className = 'day-dots';

        // One dot per event
        events.forEach(ev => {
          const dot = document.createElement('span');
          dot.className = 'day-dot';
          if (ev.status === 'confirmed') dot.classList.add('confirmed');
          else if (ev.status === 'published') dot.classList.add('published');
          wrapper.appendChild(dot);
        });

        btn.appendChild(wrapper);
      }

      btn.addEventListener('click', onDayClick);
      btn.addEventListener('keydown', (ev) => {
        if (ev.key === 'Enter' || ev.key === ' ') { ev.preventDefault(); btn.click(); }
      });

      return btn;
    }

    function onDayClick(e) {
      const btn = e.currentTarget;
      const iso = btn.dataset.date;
      if (!iso) return;

      if (selectedDate === iso) selectedDate = null;
      else selectedDate = iso;

      gridEl.querySelectorAll('.day-btn').forEach(b => b.classList.remove('selected'));
      if (selectedDate) {
        const sel = gridEl.querySelector(`[data-date="${selectedDate}"]`);
        if (sel) sel.classList.add('selected');
      }

      renderEventGrid();
      updateMapMarkers();
      selectedDayEl.textContent = formatSelectedLabel(selectedDate);
    }

    /* =================================================================
       [EVENTS::RENDER] Events List Rendering
       ================================================================= */
    function renderEventGrid() {
      clearChildren(eventsGridEl);
      selectedDayEl.textContent = formatSelectedLabel(selectedDate);

      const items = [];
      Object.keys(events).forEach(dateKey => {
        (events[dateKey] || []).forEach(ev => {
          items.push(Object.assign({}, ev, { dateKey }));
        });
      });

      items.sort((a, b) => {
        if (a.status === b.status) return a.dateKey < b.dateKey ? -1 : 1;
        return a.status === 'confirmed' ? -1 : 1;
      });

      const toRender = selectedDate ? items.filter(i => i.dateKey === selectedDate) : items;

      if (toRender.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'event-card';
        empty.style.justifyContent = 'center';
        empty.style.flexDirection = 'column';
        empty.style.alignItems = 'center';
        empty.style.gap = '8px';
        empty.style.textAlign = 'center';
        empty.style.color = '#94a3b8';
        empty.innerHTML = `<i class="ri-calendar-line" style="font-size:24px"></i><span>Nenhum evento para exibir</span>`;
        eventsGridEl.appendChild(empty);
        return;
      }

      toRender.forEach(ev => {
        const card = document.createElement('article');
        card.className = 'event-card ' + (ev.status === 'expected' ? 'expected' : 'confirmed');
        card.dataset.id = ev.id;

        const infoDiv = document.createElement('div');
        infoDiv.className = 'event-info';

        const title = document.createElement('div');
        title.className = 'event-title';
        title.textContent = ev.title;

        const meta = document.createElement('div');
        meta.className = 'event-meta';
        meta.innerHTML =
          `<span style="font-weight:600;color:var(--accent-strong)">${ev.dateKey.slice(5)}</span>` +
          ` · <i class="ri-time-line"></i> ${ev.time} · ` +
          `<i class="ri-map-pin-line"></i> ${ev.venue}`;

        infoDiv.appendChild(title);
        infoDiv.appendChild(meta);

        const controlsDiv = document.createElement('div');
        controlsDiv.className = 'event-controls';

        const badge = document.createElement('div');
        if (ev.status === 'expected') {
          badge.innerHTML =
            `<span style="display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:6px;background:rgba(249,115,22,0.1);color:var(--accent);font-size:12px;font-weight:700"><i class="ri-radar-fill"></i> Previsto</span>`;
        } else {
          badge.innerHTML =
            `<span style="display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:6px;background:rgba(16,185,129,0.1);color:var(--confirmed);font-size:12px;font-weight:700"><i class="ri-check-double-line"></i> Confirmado</span>`;
        }

        const actions = document.createElement('div');
        actions.className = 'event-actions';

        const editBtn = document.createElement('button');
        editBtn.className = 'btn small ghost';
        editBtn.innerHTML = '<i class="ri-edit-line"></i>';
        editBtn.title = "Editar";
        editBtn.addEventListener('click', (e) => { e.stopPropagation(); openEventModal(ev.id); });

        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'btn small ghost';
        deleteBtn.innerHTML = '<i class="ri-delete-bin-line"></i>';
        deleteBtn.title = "Remover";
        deleteBtn.addEventListener('click', (e) => { e.stopPropagation(); onRemoveEvent(ev.id, ev.dateKey); });

        if (ev.status === 'expected') {
          const confirmBtn = document.createElement('button');
          confirmBtn.className = 'btn small';
          confirmBtn.innerHTML = 'Confirmar';
          confirmBtn.style.padding = '4px 8px';
          confirmBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            onConfirmEvent(ev.id, ev.dateKey);
          });
          actions.appendChild(confirmBtn);
        }

        actions.appendChild(editBtn);
        actions.appendChild(deleteBtn);

        controlsDiv.appendChild(badge);
        controlsDiv.appendChild(actions);

        card.appendChild(infoDiv);
        card.appendChild(controlsDiv);

        card.addEventListener('click', (e) => {
          if (e.target.tagName.toLowerCase() === 'button' || e.target.closest('button')) return;
          if (ev.lat && ev.lng && map) map.setView([ev.lat, ev.lng], 15, { animate: true });
        });

        eventsGridEl.appendChild(card);
      });
    }

    /* =================================================================
       [ACTIONS::EVENTS] Event CRUD Actions
       PHP: Replace with AJAX calls to apollo_event_* endpoints
       ================================================================= */
    function onConfirmEvent(id, dateKey) {
      const dayEvents = events[dateKey] || [];
      const ev = dayEvents.find(x => x.id === id);
      if (!ev) return;
      ev.status = 'confirmed';
      saveEvents(events);
      renderCalendar();
      renderEventGrid();
      updateMapMarkers();
    }

    function onRemoveEvent(id, dateKey) {
      if (!confirm('Remover este evento?')) return;
      const dayEvents = events[dateKey] || [];
      const idx = dayEvents.findIndex(x => x.id === id);
      if (idx === -1) return;
      dayEvents.splice(idx, 1);
      if (dayEvents.length === 0) delete events[dateKey];
      saveEvents(events);
      renderCalendar();
      renderEventGrid();
      updateMapMarkers();
    }

    /* =================================================================
       [MODAL::FUNCTIONS] Event Create/Edit Modal
       PHP: Replace with apollo_modal() or inline form handling
       ================================================================= */
    function openEventModal(eventId) {
      const modalRoot = document.getElementById('modal-root');
      modalRoot.style.display = 'flex';
      modalRoot.innerHTML = '';

      const backdrop = document.createElement('div');
      backdrop.style.position = 'fixed';
      backdrop.style.inset = '0';
      backdrop.style.background = 'rgba(2,6,23,0.45)';
      backdrop.style.display = 'flex';
      backdrop.style.alignItems = 'center';
      backdrop.style.justifyContent = 'center';
      backdrop.style.zIndex = '9999';
      backdrop.addEventListener('click', (e) => { if (e.target === backdrop) closeModal(); });

      const modal = document.createElement('div');
      modal.style.width = 'min(720px,95%)';
      modal.style.background = '#fff';
      modal.style.borderRadius = '12px';
      modal.style.padding = '16px';
      modal.style.boxShadow = '0 12px 40px rgba(2,6,23,0.2)';

      const isEdit = !!eventId;
      modal.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <div style="font-weight:800">${isEdit ? 'Editar Evento' : 'Novo Evento'}</div>
          <button id="modal-close" class="btn ghost small"><i class="ri-close-line"></i></button>
        </div>
        <form id="event-form" style="display:flex;flex-direction:column;gap:8px">
          <input id="ev-date" type="date" class="w-full border rounded px-3 py-2" required />
          <input id="ev-title" placeholder="Nome do evento" class="w-full border rounded px-3 py-2" required />
          <div style="display:flex;gap:8px">
            <input id="ev-venue" placeholder="Local" class="flex-1 border rounded px-3 py-2" />
            <input id="ev-time" placeholder="Horário" class="w-32 border rounded px-3 py-2" />
          </div>
          <div style="display:flex;gap:8px">
            <input id="ev-lat" placeholder="Lat" class="flex-1 border rounded px-3 py-2" />
            <input id="ev-lng" placeholder="Lng" class="flex-1 border rounded px-3 py-2" />
          </div>
          <div style="display:flex;gap:8px;justify-content:flex-end">
            <button type="button" id="save-ev" class="btn">Salvar</button>
            <button type="button" id="cancel-ev" class="btn ghost">Cancelar</button>
          </div>
        </form>
      `;
      backdrop.appendChild(modal);
      modalRoot.appendChild(backdrop);

      document.getElementById('modal-close').addEventListener('click', closeModal);
      document.getElementById('cancel-ev').addEventListener('click', closeModal);

      if (isEdit) {
        let found = null; let foundDate = null;
        Object.keys(events).forEach(k => {
          (events[k] || []).forEach(ev => { if (ev.id === eventId) { found = ev; foundDate = k; } });
        });
        if (found) {
          document.getElementById('ev-date').value = foundDate;
          document.getElementById('ev-title').value = found.title;
          document.getElementById('ev-venue').value = found.venue;
          document.getElementById('ev-time').value = found.time;
          document.getElementById('ev-lat').value = found.lat || '';
          document.getElementById('ev-lng').value = found.lng || '';
        }
      } else {
        const d = selectedDate || new Date().toISOString().slice(0, 10);
        document.getElementById('ev-date').value = d;
      }

      document.getElementById('save-ev').addEventListener('click', () => {
        const date = document.getElementById('ev-date').value;
        const title = document.getElementById('ev-title').value.trim();
        const venue = document.getElementById('ev-venue').value.trim();
        const time = document.getElementById('ev-time').value.trim();
        const lat = parseFloat(document.getElementById('ev-lat').value) || null;
        const lng = parseFloat(document.getElementById('ev-lng').value) || null;
        if (!date || !title) { alert('Preencha data e nome'); return; }

        if (isEdit) {
          let found = null; let foundDate = null;
          Object.keys(events).forEach(k => {
            (events[k] || []).forEach(ev => { if (ev.id === eventId) { found = ev; foundDate = k; } });
          });
          if (found) {
            found.title = title;
            found.venue = venue;
            found.time = time;
            found.lat = lat;
            found.lng = lng;
            if (foundDate !== date) {
              events[foundDate] = events[foundDate].filter(x => x.id !== eventId);
              if (events[foundDate].length === 0) delete events[foundDate];
              events[date] = events[date] || [];
              events[date].push(found);
            }
          }
        } else {
          const id = 'e' + Math.random().toString(36).slice(2, 9);
          const newEv = { id, title, venue, time, tag: '', status: 'expected', lat, lng };
          events[date] = events[date] || [];
          events[date].push(newEv);
        }
        saveEvents(events);
        closeModal();
        renderCalendar();
        renderEventGrid();
        updateMapMarkers();
      });
    }

    function closeModal() {
      const modalRoot = document.getElementById('modal-root');
      modalRoot.style.display = 'none';
      modalRoot.innerHTML = '';
    }

    function openQuickAdd() {
      openEventModal(null);
    }

    /* [HELPERS::ESCAPE] HTML Escape Function */
    function escapeHtml(str) {
      if (!str) return '';
      return String(str).replace(/[&<>"']/g, s =>
        ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[s])
      );
    }

    /* =================================================================
       [INIT::PAGE] Page Initialization
       ================================================================= */
    prevMonthBtn.addEventListener('click', () => {
      viewMonth--;
      if (viewMonth < 0) { viewMonth = 11; viewYear--; }
      renderCalendar();
    });
    nextMonthBtn.addEventListener('click', () => {
      viewMonth++;
      if (viewMonth > 11) { viewMonth = 0; viewYear++; }
      renderCalendar();
    });
    btnAdd.addEventListener('click', () => openEventModal(null));
    toggleMapBtn.addEventListener('click', () => updateMapMarkers());

    renderCalendar();
    renderEventGrid();
    initMap();
    updateMapMarkers();

    /* [DEBUG::EXPOSE] Expose for debugging */
    window._CENARIO = { events, renderCalendar, renderEventGrid, updateMapMarkers };
  </script>

</body>

</html>