<!DOCTYPE html>
<!--
================================================================================
APOLLO TEMPLATE: DOCUMENT EDITOR (Word-like)
PHP: templates/shortcode-doc-editor.php | Shortcode: [apollo_doc_editor]

@BLOCKS: NAVBAR, TOOLBAR, EDITOR_AREA, SIDEBAR_COMMENTS, SIGNATURES
@WIDGETS: FONT_SELECT, COLOR_PICKER, TABLE_INSERT, PAGE_ZOOM, SAVE_BTN
@ELEMENTS: TOOLBAR_BTN, DROPDOWN_MENU, PAGE_CANVAS
@LAYOUTS: FIXED_TOOLBAR + SCROLLABLE_EDITOR

PHP VARS: $document, $document_id, $document_title, $content, $signatures[], 
          $current_user, $can_edit, $version_history[], $collaborators[]
================================================================================
-->
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- @PHP: echo esc_html($document_title) . ' - Apollo Editor'; -->
    <title>Apollo Word Editor</title>
    
    <!-- UNI.CSS Global Design System -->
    <link rel="stylesheet" href="https://assets.apollo.rio.br/uni.css">
    <script src="https://assets.apollo.rio.br/base.js" defer></script>
    
    <!-- Dependencies -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.7.0/fonts/remixicon.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Initial Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

    <style>
        :root {
            --apollo-primary: #3498db;
            --apollo-bg: #f0f2f5;
            --paper-width: 210mm; /* A4 width */
            --paper-height: 297mm; /* A4 min-height */
            --toolbar-height: 70px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--apollo-bg);
            color: #1a1a1a;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- Top Navigation Bar --- */
        .apollo-navbar {
            height: 50px;
            background: #fff;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            padding: 0 20px;
            flex-shrink: 0;
        }

        .brand {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: #2c3e50;
            font-size: 16px;
        }

        /* Ripple Dot Animation */
        .ripple-dot {
            width: 10px;
            height: 10px;
            background-color: var(--apollo-primary);
            border-radius: 50%;
            position: relative;
            margin-right: 15px;
            animation: rippleShadow 2s infinite ease-out;
        }

        @keyframes rippleShadow {
            0% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.6); }
            100% { box-shadow: 0 0 0 12px rgba(52, 152, 219, 0); }
        }

        .file-name {
            margin-left: 10px;
            color: #666;
            font-size: 14px;
            border: 1px solid transparent;
            padding: 2px 8px;
            border-radius: 4px;
        }
        .file-name:hover {
            border-color: #e0e0e0;
        }

        /* --- Editor Toolbar --- */
        .editor-toolbar {
            background: #fff;
            padding: 10px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: nowrap;
            overflow-x: auto;
            box-shadow: 0 2px 6px rgba(0,0,0,0.02);
            flex-shrink: 0;
            z-index: 10;
        }

        .tool-group {
            display: flex;
            align-items: center;
            gap: 6px;
            padding-right: 12px;
            border-right: 1px solid #eee;
        }
        .tool-group:last-child {
            border-right: none;
        }

        /* Customizing Form Elements */
        .form-select-sm {
            border-radius: 4px;
            border-color: #ddd;
            font-size: 13px;
            cursor: pointer;
        }
        
        #fontSelector { width: 200px; }
        #fontWeight { width: 110px; }
        #fontSize { width: 80px; }

        .btn-tool {
            width: 32px;
            height: 32px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid transparent;
            background: transparent;
            border-radius: 4px;
            color: #555;
            transition: all 0.2s;
        }
        
        .btn-tool:hover {
            background: #f5f5f5;
            border-color: #ddd;
        }
        
        .btn-tool.active {
            background: #e3f2fd;
            color: var(--apollo-primary);
            border-color: #bbdefb;
        }

        .btn-tool .material-symbols-rounded {
            font-size: 20px;
        }

        #textColor {
            width: 32px;
            height: 32px;
            padding: 2px;
            border: none;
            background: none;
            cursor: pointer;
        }

        /* --- Main Workspace --- */
        .workspace {
            flex: 1;
            overflow-y: auto;
            padding: 40px;
            display: flex;
            justify-content: center;
            position: relative;
        }

        .document-page {
            background: white;
            width: var(--paper-width);
            min-height: var(--paper-height);
            padding: 25mm;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            margin-bottom: 40px;
            outline: none;
        }

        /* Element Highlighting */
        .active-element {
            position: relative;
        }
        
        .active-element::before {
            content: '';
            position: absolute;
            left: -15px;
            top: 0;
            bottom: 0;
            width: 3px;
            background-color: var(--apollo-primary);
            opacity: 0.5;
        }

        /* Generated CSS Panel (Hidden by default, toggleable if needed) */
        #cssOutputContainer {
            display: none; /* Hide for user-friendly visual */
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #bbb; }

        @media (max-width: 900px) {
            .document-page {
                width: 100%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>

    <!-- Top Navigation -->
    <div class="apollo-navbar">
        <div class="brand">
            <div class="ripple-dot"></div>
            <span style="font-family:system-ui;font-weight:700;font-size:1.5rem;">DOC::rio</span>
            <span class="mx-3"  style="font-family:system-ui;font-weight:200;font-size:1.5rem;">/</span>
            <span class="file-name m-0 p-0 mt-2" contenteditable="true">Untitled Document</span>
        </div>
    </div>

    <!-- Editor Toolbar -->
    <div class="editor-toolbar">
        <!-- Font Family -->
        <div class="tool-group">
            <select id="fontSelector" class="form-select form-select-sm" title="Font Family">
                <option value="Poppins">Poppins</option>
                <option value="Roboto">Roboto</option>
                <option value="Open Sans">Open Sans</option>
                <option value="Noto Sans Japanese">Noto Sans Japanese</option>
                <option value="Montserrat">Montserrat</option>
                <option value="Lato">Lato</option>
                <option value="Inter">Inter</option>
                <option value="Roboto Condensed">Roboto Condensed</option>
                <option value="Roboto Mono">Roboto Mono</option>
                <option value="Oswald">Oswald</option>
                <option value="Raleway">Raleway</option>
                <option value="Nunito Sans">Nunito Sans</option>
                <option value="Nunito">Nunito</option>
                <option value="Ubuntu">Ubuntu</option>
                <option value="Rubik">Rubik</option>
                <option value="Playfair Display">Playfair Display</option>
                <option value="Merriweather">Merriweather</option>
                <option value="Noto Sans Korean">Noto Sans Korean</option>
                <option value="Roboto Slab">Roboto Slab</option>
                <option value="PT Sans">PT Sans</option>
                <option value="Kanit">Kanit</option>
                <option value="Work Sans">Work Sans</option>
                <option value="Mulish">Mulish</option>
                <option value="Lora">Lora</option>
                <option value="DM Sans">DM Sans</option>
                <option value="Noto Sans Traditional Chinese">Noto Sans TC</option>
                <option value="Fira Sans">Fira Sans</option>
                <option value="Quicksand">Quicksand</option>
                <option value="Barlow">Barlow</option>
                <option value="Inconsolata">Inconsolata</option>
                <option value="Manrope">Manrope</option>
                <option value="Hind Siliguri">Hind Siliguri</option>
                <option value="Heebo">Heebo</option>
                <option value="Titillium Web">Titillium Web</option>
                <option value="IBM Plex Sans">IBM Plex Sans</option>
                <option value="PT Serif">PT Serif</option>
                <option value="Noto Serif">Noto Serif</option>
                <option value="Karla">Karla</option>
                <option value="Bebas Neue">Bebas Neue</option>
                <option value="Nanum Gothic">Nanum Gothic</option>
                <option value="Schibsted Grotesk">Schibsted Grotesk</option>
                <option value="Libre Franklin">Libre Franklin</option>
                <option value="Outfit">Outfit</option>
                <option value="Noto Color Emoji">Noto Color Emoji</option>
                <option value="Josefin Sans">Josefin Sans</option>
                <option value="Jost">Jost</option>
                <option value="Libre Baskerville">Libre Baskerville</option>
                <option value="Source Sans 3">Source Sans 3</option>
                <option value="Mukta">Mukta</option>
            </select>
        </div>

        <!-- Weight & Size -->
        <div class="tool-group">
            <select id="fontWeight" class="form-select form-select-sm" aria-label="Font Weight" title="Font Weight">
                <option value="100">Thin (100)</option>
                <option value="200">Extra Light (200)</option>
                <option value="300">Light (300)</option>
                <option value="400">Regular (400)</option>
                <option value="500">Medium (500)</option>
                <option value="600">Semi Bold (600)</option>
                <option value="700">Bold (700)</option>
                <option value="800">Extra Bold (800)</option>
                <option value="900">Black (900)</option>
            </select>

            <select id="fontSize" class="form-select form-select-sm" aria-label="Font Size" title="Font Size">
                <option value="8px">8</option>
                <option value="10px">10</option>
                <option value="11px">11</option>
                <option value="12px">12</option>
                <option value="14px">14</option>
                <option value="16px">16</option>
                <option value="18px">18</option>
                <option value="20px">20</option>
                <option value="24px">24</option>
                <option value="28px">28</option>
                <option value="32px">32</option>
                <option value="36px">36</option>
                <option value="48px">48</option>
                <option value="72px">72</option>
            </select>
        </div>

        <!-- Formatting -->
        <div class="tool-group">
            <button id="styleItalic" class="btn-tool" title="Italic">
                <span class="material-symbols-rounded">format_italic</span>
            </button>
            <div class="d-flex align-items-center px-2">
                <input type="color" id="textColor" title="Text Color" value="#000000">
            </div>
        </div>

        <!-- Alignment -->
        <div class="tool-group">
            <button id="alignLeft" class="btn-tool alignment-btn" title="Align Left">
                <span class="material-symbols-rounded">format_align_left</span>
            </button>
            <button id="alignCenter" class="btn-tool alignment-btn" title="Align Center">
                <span class="material-symbols-rounded">format_align_center</span>
            </button>
            <button id="alignRight" class="btn-tool alignment-btn" title="Align Right">
                <span class="material-symbols-rounded">format_align_right</span>
            </button>
            <button id="alignJustify" class="btn-tool alignment-btn" title="Justify">
                <span class="material-symbols-rounded">format_align_justify</span>
            </button>
        </div>
    </div>

    <!-- Main Workspace -->
    <div id="main" class="workspace">
        <!-- The "Paper" -->
        <div class="document-page" contenteditable="true" spellcheck="false">
            <h1 id="editableHeading">The quick brown fox jumps over the lazy dog</h1>

            <h2>Title 2 Example</h2>

            <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.</p>
            <br>
            <p>Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit.</p>
            <br>
            <p>Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?</p>
        </div>
        
        <!-- Hidden output container for logic preservation -->
        <div id="cssOutputContainer">
            <pre id="cssOutput"></pre>
        </div>
    </div>

    <script>
        const fonts = {
            Poppins: "Poppins",
            Roboto: "Roboto",
            "Open Sans": "Open+Sans",
            "Noto Sans Japanese": "Noto+Sans+Japanese",
            Montserrat: "Montserrat",
            Lato: "Lato",
            Inter: "Inter",
            "Roboto Condensed": "Roboto+Condensed",
            "Roboto Mono": "Roboto+Mono",
            Oswald: "Oswald",
            Raleway: "Raleway",
            "Nunito Sans": "Nunito+Sans",
            Nunito: "Nunito",
            Ubuntu: "Ubuntu",
            Rubik: "Rubik",
            "Playfair Display": "Playfair+Display",
            Merriweather: "Merriweather",
            "Noto Sans Korean": "Noto+Sans+Korean",
            "Roboto Slab": "Roboto+Slab",
            "PT Sans": "PT+Sans",
            Kanit: "Kanit",
            "Work Sans": "Work+Sans",
            Mulish: "Mulish",
            Lora: "Lora",
            "DM Sans": "DM+Sans",
            "Noto Sans Traditional Chinese": "Noto+Sans+Traditional+Chinese",
            "Fira Sans": "Fira+Sans",
            Quicksand: "Quicksand",
            Barlow: "Barlow",
            Inconsolata: "Inconsolata",
            Manrope: "Manrope",
            "Hind Siliguri": "Hind+Siliguri",
            Heebo: "Heebo",
            "Titillium Web": "Titillium+Web",
            "IBM Plex Sans": "IBM+Plex+Sans",
            "PT Serif": "PT+Serif",
            "Noto Serif": "Noto+Serif",
            Karla: "Karla",
            "Bebas Neue": "Bebas+Neue",
            "Nanum Gothic": "Nanum+Gothic",
            "Schibsted Grotesk": "Schibsted+Grotesk",
            "Libre Franklin": "Libre+Franklin",
            Outfit: "Outfit",
            "Noto Color Emoji": "Noto+Color+Emoji",
            "Josefin Sans": "Josefin+Sans",
            Jost: "Jost",
            "Libre Baskerville": "Libre+Baskerville",
            "Source Sans 3": "Source+Sans+3",
            Mukta: "Mukta"
        };

        $(document).ready(function () {
            let activeElement = $(".document-page h1"); // Default selection
            let loadedFonts = new Set();
            let elementStyles = new Map();
            let googleFontLinks = new Set();

            function updateCSSOutput() {
                let cssOutput = "";
                googleFontLinks.forEach((link) => {
                    cssOutput += `@import url('${link}');\n`;
                });
                // We now target direct children of the document page to avoid styling the container itself
                $(".document-page").children().each(function () {
                    let tag = $(this).prop("tagName").toLowerCase();
                    let styles = $(this).attr("style");
                    if (styles) {
                        cssOutput += `${tag} { ${styles} }\n`;
                    }
                });
                $("#cssOutput").text(cssOutput);
            }

            function rgbToHex(rgb) {
                if (!rgb || rgb === 'rgba(0, 0, 0, 0)') return '#000000';
                let result = rgb.match(/\d+/g);
                if (!result) return "#000000";
                return `#${(
                        (1 << 24) +
                        (parseInt(result[0]) << 16) +
                        (parseInt(result[1]) << 8) +
                        parseInt(result[2])
                ).toString(16).slice(1).toUpperCase()}`;
            }

            function applyStoredStyles(element) {
                // Remove marker from all children
                $(".document-page").children().removeClass("active-element");
                element.addClass("active-element");
                
                let styles = elementStyles.get(element[0]) || {};
                
                // Populate toolbar values based on current element
                let currentFont = element.css("font-family").replace(/['"]/g, '').split(',')[0];
                $("#fontSelector").val(styles["font-family"] || currentFont);
                $("#fontSize").val(styles["font-size"] || element.css("font-size"));
                $("#fontWeight").val(styles["font-weight"] || element.css("font-weight"));
                $("#textColor").val(styles["color"] || rgbToHex(element.css("color")));

                $("#styleItalic").toggleClass("active", styles["font-style"] === "italic" || element.css("font-style") === "italic");
                
                let align = styles["text-align"] || element.css("text-align");
                $(".alignment-btn").removeClass("active");
                if(align === 'left') $("#alignLeft").addClass("active");
                if(align === 'center') $("#alignCenter").addClass("active");
                if(align === 'right') $("#alignRight").addClass("active");
                if(align === 'justify') $("#alignJustify").addClass("active");
            }

            // Handle click inside the editor to select elements
            $(".document-page").on("click", "*", function (e) {
                e.stopPropagation(); // Prevent bubbling to parent
                activeElement = $(this);
                // Ensure we are selecting a block level element or the clicked element
                if($(this).hasClass('document-page')) return; // Don't select the wrapper
                applyStoredStyles(activeElement);
            });

            function updateStyle(property, value) {
                if (activeElement && activeElement.length) {
                    activeElement.css(property, value);
                    let styles = elementStyles.get(activeElement[0]) || {};
                    styles[property] = value;
                    elementStyles.set(activeElement[0], styles);
                    updateCSSOutput();
                }
            }

            $("#fontSize").on("change", function () {
                updateStyle("font-size", $(this).val());
            });

            $("#fontWeight").on("change", function () {
                updateStyle("font-weight", $(this).val());
            });

            $("#textColor").on("input", function () {
                updateStyle("color", $(this).val());
            });

            $("#alignLeft, #alignCenter, #alignRight, #alignJustify").on(
                "click",
                function () {
                    let alignment = $(this).attr("id").replace("align", "").toLowerCase();
                    updateStyle("text-align", alignment);
                    $(".alignment-btn").removeClass("active");
                    $(this).addClass("active");
                }
            );

            $("#styleItalic").on("click", function () {
                if (activeElement) {
                    let isItalic = activeElement.css("font-style") === "italic";
                    let newValue = isItalic ? "normal" : "italic";
                    updateStyle("font-style", newValue);
                    $(this).toggleClass("active", !isItalic);
                }
            });

            $("#fontSelector").on("change", function () {
                if (activeElement) {
                    let font = $(this).val();
                    // Clean up font name for Google API
                    let fontQuery = font.replace(/ /g, "+");
                    let fontUrl = `https://fonts.googleapis.com/css2?family=${fontQuery}:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap`;
                    
                    if (!loadedFonts.has(font)) {
                        $("head").append(
                            `<link rel="stylesheet" href="${fontUrl}" class="dynamic-font">`
                        );
                        loadedFonts.add(font);
                        googleFontLinks.add(fontUrl);
                    }
                    updateStyle("font-family", `"${font}", sans-serif`);
                }
            });

            // Apply Default Styles for initial look
            $(".document-page h1").css({ "font-family": "Poppins", "font-size": "48px", "font-weight": "600", "color": "#000" });
            $(".document-page h2").css({ "font-family": "Poppins", "font-size": "32px", "font-weight": "600", "color": "#333" });
            $(".document-page p").css({ "font-family": "Poppins", "font-size": "16px", "color": "#444", "line-height": "1.6" });

            // Initialize
            if(activeElement.length) {
                applyStoredStyles(activeElement);
            }
            updateCSSOutput();
        });
    </script>
</body>
</html>